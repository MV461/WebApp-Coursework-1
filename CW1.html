<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Lesson Shop</title>

    <!-- Vue.js CDN import START -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- Vue.js CDN import END -->

    <!-- Bootstrap CDN import START -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <!-- Bootstrap CDN import END -->

    <!-- Bootstrap Icons import START -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Bootstrap Icons import END -->

    <!-- Font Awesome Kit import START -->
    <script src="https://kit.fontawesome.com/d0fcba61dc.js" crossorigin="anonymous"></script>
    <!-- Font Awesome Kit import END -->

    <style>
        #navbarNav .nav-link:hover {
            color: white;
            background-color: blue;
        }

        #navbarNav #cart:hover {
            color: white;
            background-color: red;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="row">
            <!-- Navbar START -->
            <nav class="navbar navbar-expand-md bg-body-tertiary p-2">
                <div class="container-fluid">

                    <!-- NavBar Brand START -->
                    <span class="navbar-brand mb-0 h1">Lesson Shop</span>
                    <!-- NavBar Brand END -->

                    <!-- Hamburger Menu Button START -->
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <!-- Hamburger Menu Button END -->

                    <!-- Nav Links START -->
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <div class="navbar-nav mx-auto p-2">
                            <button @click="showCart = false" class="btn btn-outline-primary">Products</button>
                        </div>
                        <div class="navbar-nav p-2">
                            <button :disabled="isCartEmpty" @click="showCart = !showCart"
                                class="btn btn-outline-danger">Cart</button>
                        </div>

                    </div>
                    <!-- Nav Links END -->

                </div>
            </nav>
            <!-- Navbar END -->
        </div>


        <div v-if="showCart">
            <div class="col p-3">
                <div class="row">
                    <h1>Cart Details</h1>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">Subject</th>
                                <th scope="col">Price</th>
                                <th scope="col">Quantity</th>
                                <th scope="col">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="cartTableEntry in cartTableContents" :key="cartTableEntry.lesson.id">
                                <td><i :class="cartTableEntry.lesson.icon.replace('fa-4x', '')"></i> {{
                                    cartTableEntry.lesson.subject }}</td>
                                <td>{{ cartTableEntry.lesson.price }} AED</td>
                                <td class="d-flex">
                                    <span class="me-auto">
                                        {{ cartTableEntry.quantity }}
                                    </span>

                                    <button class="btn btn-outline-secondary m-1"
                                        v-if="cartTableEntry.lesson.spaces > 0"
                                        @click="addToCart(cartTableEntry.lesson.id)">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary m-1"
                                        @click="removeFromCart(cartTableEntry.lesson.id)">
                                        <i class="bi bi-dash"></i>
                                    </button>
                                </td>
                                <td>{{ cartTableEntry.subtotal }} AED</td>
                            </tr>
                        </tbody>
                        <tfoot class="table-group-divider">
                            <tr>
                                <th colspan="3" scope="row">Total:</th>
                                <td><b>{{ cartPrice }} AED</b></td>
                            </tr>
                        </tfoot>

                    </table>
                </div>

                <div class="row p-2 border">
                    <h1>Order Form</h1>
                    <form @submit.prevent="orderFormSubmit">
                        <div class="mb-3">
                            <label for="name-input" class="form-label">Name</label>
                            <input @input="restrictNameInput" v-model="formData.name" placeholder="Enter Name"
                                type="text" class="form-control" id="name-input">
                        </div>
                        <div class="mb-3">
                            <label for="phoneNumber-input" class="form-label">Phone Number</label>
                            <input @input="restrictPhoneNumberInput" v-model="formData.number"
                                placeholder="Enter Phone Number" type="text" class="form-control"
                                id="phoneNumber-input">
                        </div>
                        <button :disabled="!(formData.name && formData.number)" type="submit"
                            class="btn btn-primary">Submit</button>
                    </form>
                </div>

            </div>
        </div>
        <div v-else>
            <div class="row p-2 pt-4">
                <div class="col-md-3">
                    <aside class="h-100 mb-5">

                        <div class="border p-3">
                            <h2>Sort By:</h2>

                            <input type="radio" class="btn-check" name="sort-group" id="subject" value="subject"
                                v-model="sortOption">
                            <label class="btn" for="subject">Subject</label>

                            <input type="radio" class="btn-check" name="sort-group" id="price" value="price"
                                v-model="sortOption">
                            <label class="btn" for="price">Price</label>


                            <input type="radio" class="btn-check" name="sort-group" id="location" value="location"
                                v-model="sortOption">
                            <label class="btn" for="location">Location</label>


                            <input type="radio" class="btn-check" name="sort-group" id="spaces" value="spaces"
                                v-model="sortOption">
                            <label class="btn" for="spaces">Spaces</label>
                        </div>

                        <div class="border p-3">
                            <h2>Order By:</h2>

                            <input type="radio" class="btn-check" name="order-group" id="ascending" value="ascending"
                                v-model="orderOption">
                            <label class="btn" for="ascending">Ascending</label>


                            <input type="radio" class="btn-check" name="order-group" id="descending" value="descending"
                                v-model="orderOption">
                            <label class="btn" for="descending">Descending</label>
                        </div>

                    </aside>
                </div>

                <div class="col-md-9">
                    <main>
                        <input type="text" class="form-control form-control-lg mb-3" placeholder="Search Products..."
                            v-model="search">

                        <div v-if="lessons">

                            <!-- Card Group START -->
                            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">

                                <!-- Card Column START -->
                                <div class="col" v-for="lesson in orderedLessons" :key="lesson.id">

                                    <!-- Card START -->
                                    <div class="card text-center">
                                        <!-- Card Row START -->
                                        <div class="row g-0">

                                            <!-- Card Col 1 START -->
                                            <div class="col-md-4 d-flex justify-content-center align-items-center">

                                                <!-- Card Icon START -->
                                                <span class="card-icon p-2">
                                                    <i :class="lesson.icon"></i>
                                                </span>
                                                <!-- Card Icon END -->

                                            </div>
                                            <!-- Card Col 1 END -->

                                            <!-- Card Col 2 START -->
                                            <div class="col-md-8 bg-light">

                                                <!-- Card Header START -->
                                                <div class="card-header">
                                                    {{ lesson.subject }} Lessons
                                                </div>
                                                <!-- Card Header END -->

                                                <!-- Card Body START -->
                                                <div class="card-body">

                                                    <table class="table table-bordered">
                                                        <tbody>
                                                            <tr>
                                                                <td><strong>Location</strong></td>
                                                                <td>{{ lesson.location }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>Price</strong></td>
                                                                <td>{{ lesson.price }} AED</td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>Available Spaces</strong></td>
                                                                <td>{{ lesson.spaces }}</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>

                                                </div>
                                                <!-- Card Body END -->

                                                <div class="card-footer">
                                                    <button @click="addToCart(lesson.id)"
                                                        :disabled="lesson.spaces === 0" class="btn btn-primary m-2">
                                                        {{ lesson.spaces === 0 ? 'No Spaces Available' : 'Add to Cart'
                                                        }}
                                                    </button>
                                                    <button v-if="cart[lesson.id]" @click="removeFromCart(lesson.id)"
                                                        class="btn btn-danger m-2">
                                                        Remove from Cart
                                                    </button>

                                                </div>

                                            </div>
                                            <!-- Card Col 2 END -->


                                        </div>
                                        <!-- Card Row END -->

                                    </div>
                                    <!-- Card END -->

                                </div>
                                <!-- Card Column START -->
                            </div>
                            <!-- Card Group END -->
                        </div>

                        <div v-else>
                            <h1>Loading JSON data...</h1>
                        </div>

                    </main>
                </div>
            </div>
        </div>

    </div>



    <script>
        let webstore = new Vue({
            el: "#app",
            data: {
                lessons: null,
                cart: {},
                formData: {
                    name: "",
                    number: ""
                },
                showCart: false,
                search: "",
                sortOption: "price",
                orderOption: "ascending"
            },

            created() {
                // Using created() to initialise values before it gets used.
                // Need to use Fetch API, as 'import' is not available.
                fetch('lessons.json')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        this.lessons = data;
                    })
                    .catch(error => {
                        console.error('Error loading JSON data', error);
                    });
            },

            methods: {
                addToCart(lessonID) {
                    const CART = this.cart;
                    const QUANTITY_IN_CART = CART[lessonID];
                    const ZERO_QUANTITY = null;
                    const NEW_QUANTITY = ((QUANTITY_IN_CART == ZERO_QUANTITY) ? (1) : (QUANTITY_IN_CART + 1));
                    const ADDED_LESSON = this.lessons.find((lesson) => lesson.id === lessonID);


                    this.$set(CART, lessonID, NEW_QUANTITY)
                    ADDED_LESSON.spaces--;
                },

                removeFromCart(lessonID) {
                    const CART = this.cart;
                    const QUANTITY_IN_CART = CART[lessonID];
                    const REDUCED_QUANTITY = QUANTITY_IN_CART - 1;
                    const ADDED_LESSON = this.lessons.find((lesson) => lesson.id === lessonID);


                    this.$set(CART, lessonID, REDUCED_QUANTITY)
                    if (REDUCED_QUANTITY === 0) { this.$delete(CART, lessonID); }
                    ADDED_LESSON.spaces++;
                },

                orderFormSubmit() {

                    const ORDER = {
                        formData: this.formData,
                        cart: this.cart
                    }
                    const ORDER_STRING = JSON.stringify(ORDER, null, 2)
                    const RELOAD_PAGE = window.location.reload();


                    alert(`Order Placed!\n\n${ORDER_STRING}`);
                    RELOAD_PAGE;
                },

                restrictNameInput(nameFieldInput) {
                    const FORM_DATA = this.formData;

                    const NAME_INPUT = nameFieldInput.target.value;
                    const NAME_REGEX = /[^A-Za-z]/g;
                    const SANITISED_NAME_INPUT = NAME_INPUT.replace(NAME_REGEX, '');


                    FORM_DATA["name"] = SANITISED_NAME_INPUT;
                },

                restrictPhoneNumberInput(phoneNumberFieldInput) {
                    const FORM_DATA = this.formData;

                    const PHONE_NUMBER_INPUT = phoneNumberFieldInput.target.value;
                    const PHONE_NUMBER_REGEX = /\D/g;
                    const SANITISED_PHONE_NUMBER_INPUT = PHONE_NUMBER_INPUT.replace(PHONE_NUMBER_REGEX, '');


                    FORM_DATA["number"] = SANITISED_PHONE_NUMBER_INPUT;
                }
            },

            computed: {
                filteredLessons() {
                    const LESSONS = this.lessons;
                    const CATEGORIES_TO_SEARCH = ['subject', 'location', 'price', 'spaces'];
                    const QUERY = this.search.toLowerCase();


                    return LESSONS.filter(
                        (lesson) => CATEGORIES_TO_SEARCH.some(
                            (attribute) => {
                                const ATTRIBUTE_VALUE = lesson[attribute];
                                const FORMATTED_ATTRIBUTE_VALUE = ATTRIBUTE_VALUE.toString().toLowerCase();


                                return FORMATTED_ATTRIBUTE_VALUE.includes(QUERY)
                            }
                        )
                    )
                },

                sortedLessons() {
                    const FILTERED_LESSONS = this.filteredLessons;
                    const ATTRIBUTE_TO_SORT_BY = this.sortOption;
                    const SORT_FUNCTION_SELECTOR = {
                        'subject': (lesson1, lesson2) => lesson1.subject.localeCompare(lesson2.subject),
                        'price': (lesson1, lesson2) => lesson1.price - lesson2.price,
                        'location': (lesson1, lesson2) => lesson1.location.localeCompare(lesson2.location),
                        'spaces': (lesson1, lesson2) => lesson1.spaces - lesson2.spaces
                    };


                    return FILTERED_LESSONS.sort(SORT_FUNCTION_SELECTOR[ATTRIBUTE_TO_SORT_BY]);
                },

                orderedLessons() {
                    const SORTED_LESSONS = this.sortedLessons.slice();
                    const ORDER_BY = this.orderOption;


                    if (ORDER_BY === 'descending') {
                        return SORTED_LESSONS.reverse();
                    }
                    return SORTED_LESSONS;
                },

                cartTableContents() {
                    const CART_IS_EMPTY = this.isCartEmpty;
                    const CART_ITEMS = Object.entries(this.cart);


                    if (CART_IS_EMPTY) {
                        this.showCart = false;
                        return;
                    }

                    let cartTableEntries = [];
                    CART_ITEMS.forEach(
                        ([lessonID, quantity]) => {

                            const LESSON = this.lessons.find((lesson) => lesson.id === parseInt(lessonID));
                            cartTableEntries.push(
                                {
                                    lesson: LESSON,
                                    quantity: quantity,
                                    subtotal: LESSON.price * quantity
                                }
                            )
                        }
                    )

                    cartTableEntries.sort(
                        (entry1, entry2) => entry1.lesson.subject.localeCompare(entry2.lesson.subject)
                    )

                    return cartTableEntries;
                },

                cartPrice() {
                    const CART_ITEMS = this.cartTableContents;
                    const TOTAL_PRICE = CART_ITEMS.reduce(((acc, entry) => acc + entry.subtotal), 0)


                    return TOTAL_PRICE;

                },

                isCartEmpty() {
                    return !Object.keys(this.cart).length;
                }
            }
        });
    </script>

</body>

</html>